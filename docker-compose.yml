version: '3.8'

services:
  api:
    build: .
    container_name: npe1-colecture
    ports:
      - "8080:8080"
    environment:
      - PYTHONUNBUFFERED=1
      # API Keys (set these in Portainer Stack environment variables)
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - UNSPLASH_ACCESS_KEY=${UNSPLASH_ACCESS_KEY}
      - PEXELS_API_KEY=${PEXELS_API_KEY}
      - SIGHTENGINE_API_USER=${SIGHTENGINE_API_USER}
      - SIGHTENGINE_API_SECRET=${SIGHTENGINE_API_SECRET}
      - FLUX_API_KEY=${FLUX_API_KEY}
      # Optional
      - SCORING_SERVICE_URL=${SCORING_SERVICE_URL:-}
      - MIN_PRESENTATION_SCORE=${MIN_PRESENTATION_SCORE:-0.6}
      - MIN_QUALITY_SCORE=${MIN_QUALITY_SCORE:-0.7}
      - MIN_NUDITY_SAFE_SCORE=${MIN_NUDITY_SAFE_SCORE:-0.99}
    restart: unless-stopped
    # NOTE: volumes removed for Portainer deployment
    # The src/ directory is baked into the image during build
    # Do NOT mount ./src:/app/src as it will be empty in Portainer's runtime context
    networks:
      - cloudflare_net

networks:
  cloudflare_net:
    external: true
